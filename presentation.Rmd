---
title: "Final Presentation"
subtitle: "Are different parts of the city windier than others?"  
author: 
  - "Panagiotis Stylianos"
  - "Emily Sheehan"
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["ninjutsu", "lucy", "my_style.css"]
    seal: false
    includes:
       after_body: "collapseoutput.js"
    nature:
      highlightStyle: github 
      highlightLanguage: r 
      highlightLines: true
      highlightSpans: false 
      countIncrementalSlides: false
      slideNumberFormat: '%current%/%total%'
      ratio: '16:9'
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo=FALSE)
```
class: title-slide, my-one-page-font 



# Wind

# é¢¨


.left[Authors: <br>
.green[Emily Sheehan] <br>
.green[Panagiotis Stylianos]
] <br>

.left[`r Sys.Date()`]

.footer[`r icon::fa('book')` ETC5523:Communicating with Data]

```{r xaringan-themer, message=FALSE, warning=FALSE, include=FALSE }
library(xaringanthemer)
library(xaringanExtra)
library(tidyverse)
library(leaflet)
library(patchwork)
library(anicon)
library("countdown")
library(calendR)
library(lubridate)
library(ggtext)

style_duo_accent(
  primary_color = "#1381B0",
  secondary_color = "#FF961C",
  inverse_header_color = "#FFFFFF"
)
```

```{r load-data}
loc <- read_csv("data/locations.csv") %>% 
  select(c(site_id, description, latitude, longitude)) %>% 
  as_tibble()
readings <- read_csv("data/readings.csv")  %>% 
  as_tibble()
sensors <- readings %>% 
  left_join(loc, by = "site_id") 
```

```{r wrangling-data, cache = TRUE}
sensors_wind <- sensors %>%
  mutate(month = lubridate::month(local_time)) %>%
  filter(units == "km/h") %>%
  mutate(time = format(as.POSIXct(local_time, "%Y-%m-%d %I:%M:%S %p"), format = "%H:%M")) %>%
  filter(!is.na(value))
           
          # strptime(as.POSIXct(local_time), "%I:%M %p"), format="%H:%M:%S"))

sensors_wind_average <- 
  sensors_wind %>%
  mutate(average = mean(value)) %>%
  group_by(average, 
           description,
           site_id,
           month) %>%
  summarise(average_value = mean(value)) %>%
  mutate(diff = (average - average_value),
         diff = round(diff,2))
```

```{r xaringan-logo}
xaringanExtra::use_logo(
  image_url = "https://www.monash.edu/__data/assets/image/0020/2213408/fb-thumbnail.jpg"
)
xaringanExtra::use_webcam(width = 300, height = 225)
xaringanExtra::use_slide_tone()
```

```{r xaringan-extra-styles}
xaringanExtra::use_extra_styles(
  hover_code_line = TRUE,         #<<
  mute_unhighlighted_code = TRUE  #<<
)
xaringanExtra::use_tile_view()
```
---
class: inverse, center, middle, split-two with-thick-border border-green
.column.bg-main1[
<center>
<middle>
```{r map, echo=FALSE}
leaflet(loc) %>% 
  addProviderTiles("Esri") %>% 
  addMarkers(lng = loc$longitude,
             lat = loc$latitude,
             popup = loc$description)
```
]

.column.bg-main1[
### .white[**The location of the five sensors are:**]

### .white[141 Grattan St, Carlton] <br>
### .white[3/121 Grattan St, Carlton] <br>
### .white[87-89 Grattan St] <br>
### .white[Cnr Pelham and Leicester St] <br>
### .white[Cnr Swanston and Grattan St] <br>
]
---
class: split-three with-thick-border border-green




.column.bg-main1[.content[

### .white[Grattan Street, Carlton]

<br>
<center>
<img class="border-box" src="https://i1.au.reastatic.net/768x512-smart=75,r=33,g=40,b=46,quality=60,progressive/acd0a8aa867bac0b555c01d972e4b10633f4f791444107425f2c691a0b05dacb/image0.jpg" width = "200px">
</center>
<br>

The three sensors that are located at *Grattan Street, Carlton* are:

Arc1043

Arc1048

Arc1050

]]

.column.bg-main1[.content[

### .white[Cnr of Swanston and Grattan Street, Carlton]


<br>
<center>
<img class="border-box" src="https://i2.au.reastatic.net/800x600/a487bda2e0d2c2761726a10a4eb376eea12fe2165b226dc8cff2b99c97612fc7/image.jpg" width = "200px">
</center>
<br><br>

The sensor that is located at *the corner of Swanston and Grattan Street, Carlton* is:

Arc.1046

]]

.column.bg-main1[.content[

### .white[Cnr of Pelham and Leicester Street, Carlton]


<br>
<center>
<img class="border-box" src="https://www.commo.com.au/sites/default/files/styles/front_left_column/public/carltonpellhamst147155dronedji_0063_002.jpg?itok=ZrZPS3JQ" width = "200px">
</center>
<br>

The sensor that is located at *the corner of Pelham and Leicester Street, Carlton* is:

Arc.1047

]]

.footer[`r icon::fa('book')` ETC5523:Communicating with Data]
---

## .white[**When is the city the windiest?**]


--

```{r echo=FALSE}
knitr::include_graphics("https://media1.giphy.com/media/HmTLatwLWpTQk/giphy.gif?cid=ecf05e47155457f6vxh5f6rjvr84ipw53d5vi22i8kvu72dx&rid=giphy.gif") #<<
```

.footer[`r icon::fa('book')` ETC5523:Communicating with Data]

---

## .white[Monthly differences]

.panelset[
.panel[.panel-name[Summary]

This plot shows the monthly difference for wind speed.

>The wind speed tends to be highest around the **summer months**.

>The wind speed is the lowest around the **winter months**, particularly for 87-89 Grattan St and the Cnr of Leiscester and Pelham St. 

>The wind is fairly consistent throughout the year for 141 and 121 Grattan St, which makes sense given they are so close.

]

.panel[.panel-name[Plot]
```{r, echo=FALSE, cache = TRUE, fig.height = 6, fig.width=14, fig.retina=3}
monthly_sensors <-  sensors %>% 
  mutate(day = lubridate::ymd(as.Date(local_time)),
         month = lubridate::month(local_time),
         hour = hour(as_datetime(local_time))
  )


monthly_sensors %>% 
  filter(units == "km/h") %>% 
  ggplot(aes(x = as.factor(month), 
             y = value, 
             fill = description)) +
  ggthemes::theme_solarized() +
  theme(legend.position = "bottom",
        legend.title =  element_blank(),
        legend.box.background = element_blank(),
        strip.text.x = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.subtitle = ggtext::element_markdown(),
        plot.caption = ggtext::element_markdown(),
        axis.title.y = ggtext::element_textbox_simple(
          size = 13,
          width = NULL,
          orientation = "left-rotated",
          padding = margin(4, 4, 4, 4),
          margin = margin(4, 0, 0, 0),
          linetype = 1,
          r = grid::unit(8, "pt"),
          fill = "azure1",
        ),
        axis.title.x = ggtext::element_textbox_simple(
          size = 13,
          width = NULL,
          padding = margin(4, 4, 4, 4),
          margin = margin(4, 0, 0, 0),
          linetype = 1,
          r = grid::unit(8, "pt"),
          fill = "azure1",
        ),
        plot.title  = ggtext::element_textbox_simple(
          size = 13,
          width = NULL,
          padding = margin(4, 4, 4, 4),
          margin = margin(4, 0, 10, 0),
          linetype = 1,
          r = grid::unit(8, "pt"),
          fill = "azure1",
        ),
        legend.key = element_rect(fill = "transparent", colour = "transparent")) +
  geom_boxplot() +
  facet_wrap(~description,
             nrow=1) +
  ggthemes::scale_fill_colorblind() +
  guides(fill=guide_legend(nrow=2, byrow=TRUE)) +
  labs(
    x = "Month",
    y = "Wind Speed",
    title = "Distribution of Wind Speed by Month",
    subtitle = 
    "Notice that the readings of the <span style='color:blue'>blue</span> and
     <span style='color:darkgreen'>green</span>
    sensors vary significantly from the rest.<br><br>
    Overall the wind speed tends to be highest around the summer months.",
   caption = "Data from City of Melbourne Open Data-Microclimate Sensor Readings"
    ) 
```
]
]

---
## .white[Hourly differences]

.panelset[
.panel[.panel-name[Summary]

This plot shows the hourly difference for wind speed.

> The wind speed peaks between **1pm and 2pm** for all locations.

]

.panel[.panel-name[Plot]
```{r, echo=FALSE, fig.height = 6, fig.width=14, fig.retina=3}
monthly_sensors %>% 
  filter(units == "km/h") %>% 
  ggplot(aes(x = as.factor(hour), y = value,  fill = description)) +
  geom_boxplot() +
  facet_wrap(~site_id, ncol = 2) +
  ggthemes::theme_solarized() +
  theme(legend.position = "bottom",
        legend.title =  element_blank(),
        legend.box.background = element_blank(),
        strip.text.x = element_blank(),
        axis.text.x = element_text(size = 5),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.subtitle = ggtext::element_markdown(),
        plot.caption = ggtext::element_markdown(),
        axis.title.y = ggtext::element_textbox_simple(
          size = 13,
          width = NULL,
          orientation = "left-rotated",
          padding = margin(4, 4, 4, 4),
          margin = margin(4, 0, 0, 0),
          linetype = 1,
          r = grid::unit(8, "pt"),
          fill = "azure1",
        ),
        axis.title.x = ggtext::element_textbox_simple(
          size = 13,
          width = NULL,
          padding = margin(4, 4, 4, 4),
          margin = margin(4, 0, 0, 0),
          linetype = 1,
          r = grid::unit(8, "pt"),
          fill = "azure1",
        ),
        plot.title  = ggtext::element_textbox_simple(
          size = 13,
          width = NULL,
          padding = margin(4, 4, 4, 4),
          margin = margin(4, 0, 10, 0),
          linetype = 1,
          r = grid::unit(8, "pt"),
          fill = "azure1",
        ),
        legend.key = element_rect(fill = "transparent", colour = "transparent")) +
  geom_boxplot() +
  facet_wrap(~description,
             nrow=1) +
  ggthemes::scale_fill_colorblind() +
  guides(fill=guide_legend(nrow=2, byrow=TRUE)) +
  labs(
    x = "Hour",
    y = "Wind Speed",
    title = "Distribution of Wind Speed by Hour",
    subtitle = 
      "Notice that the wind speed peaks between 1pm and 2pm for all locations.<br><br>
    The readings of the <span style='color:blue'>blue</span> and
     <span style='color:darkgreen'>green</span> have measured wind speeds of 0 km/h, which might be an indicator of sensors inability to accurately measure soft winds.",
    caption = "Data from City of Melbourne Open Data-Microclimate Sensor Readings") 


```

]
]

---
## .white[Wind Speed per Day]

.panelset[
.panel[.panel-name[Summary]

This plot shows the days in the year when the wind speed was above average. 

>This figure supports the previous plot as it clearly shows December (a summer month) as having the most days with above average wind across all locations. 

> Another interesting observation is that windier days tend to occur consecutively (in bouts of 2-3 days). 

]

.panel[.panel-name[Plot]

```{r, echo=FALSE, cache = TRUE, fig.height = 6, fig.width=14, fig.retina=3}

mean_wind <- sensors %>%
  filter(units == "km/h") %>%
  summarise(mean = mean(value, na.rm = TRUE)) %>% 
  pull(mean) %>% 
  as.numeric()

wind_by_day <-   monthly_sensors %>%
  group_by(day) %>% 
  filter(units == "km/h") %>%
  summarise(mean_day_wind = mean(value, na.rm = TRUE)) %>% 
  ungroup() %>% 
  filter(mean_day_wind >= mean_wind) %>% 
  select(day) %>% 
  mutate(cal_day =
           case_when(
             day < "2020-01-01" ~
               day - as.Date(as.character("2019-01-01"), format="%Y-%m-%d"),
             day >= "2020-01-01" ~
               day - as.Date(as.character("2020-01-01"), format="%Y-%m-%d")
             
           )
  )


calendR(year = 2020,
        start = "M",
        special.days = wind_by_day$cal_day,
        special.col = "lightblue",            # Color of the specified days
        low.col = "cornsilk",
        col = "black",
        weeknames.size = 3,
        months.size = 7,
        months.col = "black",
        day.size = 2,
        orientation ="p",
        bg.col = "grey90",
        title = "",
        subtitle = "") +
  theme(legend.position = "none",
        legend.title =  element_blank(),
        legend.box.background = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.title.position = "plot",
        plot.subtitle = ggtext::element_markdown(
          size = 12,
        ),
        plot.title  = ggtext::element_textbox_simple(
          size = 15,
          width = NULL,
          padding = margin(4, 4, 4, 4),
          margin = margin(4, 0, 10, 0),
          linetype = 1,
          r = grid::unit(8, "pt"),
          fill = "azure1",
        ),
        legend.key = element_rect(fill = "transparent", colour = "transparent")) +
  labs(
    y = "",
    x = "",
    title = "Days with __above__ average wind speeds",
    subtitle = 
      "Notice that the majority of days that experienced above average wind speeds
    is during <span style='color:purple'>summer</span>, which indicates that  
    the increase in temperature might produce stronger winds"
    ) 

```

]
]

---


## .white[**Are different parts of the city windier than others?**]

--

<img src="https://c4.wallpaperflare.com/wallpaper/30/379/591/anime-landscape-wallpaper-preview.jpg" width="40%">

.footer[`r icon::fa('book')` ETC5523:Communicating with Data]
---

## .white[Are different parts of the city windier than others?]

```{r xaringan-panelset-1, echo=FALSE}
xaringanExtra::use_panelset()
```

.panelset[
.panel[.panel-name[Summary]

This graph compares the average monthly wind speed for each location against the average yearly wind speed. To generate this graph we calculated the average yearly wind speed over the year for all locations, and then calculated the difference for each location and month.

>The summer months are less windy and the winter months have the highest wind speeds.

>The Cnr of Pelham and Leicester St and 87-89 Grattan St are the windiest areas over the year as they are consistently above the yearly average wind speed.

>The Cnr of Swanston and Grattan has higher wind speeds in September and October

>The most .white[**interesting**] insight was that the wind speed varies .white[**greatly**] in Grattan St.





]

.panel[.panel-name[Plot]
```{r echo = FALSE, cache = TRUE, fig.width=14, fig.height=5, fig.retina=3}
ggplot(sensors_wind_average,
       aes(x = month,
           y = diff,
           fill = description)) +
  geom_hline(aes(yintercept = 0)) +
  geom_bar(stat="identity",
           position = "dodge") +
  theme_classic() +
  theme(legend.position = "bottom") +  
  scale_x_continuous(breaks=seq(1, 12, 1),
                     labels = c("1" = "Jan",
                                   "2" = "Feb", 
                                   "3" = "Mar", 
                                   "4" = "Apr",
                                   "5" = "May", 
                                   "6" = "Jun", 
                                   "7" = "Jul", 
                                   "8" = "Aug", 
                                   "9" = "Sep", 
                                   "10" = "Oct", 
                                   "11" = "Nov", 
                                   "12" = "Dec")) +
  ggtitle("The Average Monthly Wind Speed Difference (from the Average Wind Speed)") +
  ggthemes::theme_solarized() +
  theme(legend.position = "bottom",
        legend.title =  element_blank(),
        legend.box.background = element_blank(),
        strip.text.x = element_blank(),
        axis.text.x = element_text(size = 5),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.subtitle = ggtext::element_markdown(),
        plot.caption = ggtext::element_markdown(),
        axis.title.y = ggtext::element_textbox_simple(
          size = 13,
          width = NULL,
          orientation = "left-rotated",
          padding = margin(4, 4, 4, 4),
          margin = margin(4, 0, 0, 0),
          linetype = 1,
          r = grid::unit(8, "pt"),
          fill = "azure1",
        ),
        axis.title.x = ggtext::element_textbox_simple(
          size = 13,
          width = NULL,
          padding = margin(4, 4, 4, 4),
          margin = margin(4, 0, 0, 0),
          linetype = 1,
          r = grid::unit(8, "pt"),
          fill = "azure1",
        ),
        plot.title  = ggtext::element_textbox_simple(
          size = 13,
          width = NULL,
          padding = margin(4, 4, 4, 4),
          margin = margin(4, 0, 10, 0),
          linetype = 1,
          r = grid::unit(8, "pt"),
          fill = "azure1",
        ),
        legend.key = element_rect(fill = "transparent", colour = "transparent")) +  ggthemes::scale_fill_colorblind() +
  guides(fill=guide_legend(nrow=2, byrow=TRUE)) +
  labs(
    x = "",
    y = "Average monthly wind speed difference"
  )
```
]
]

---

## .white[**Why?**]


--

Since the sensors are so close, it is unlikely that wind speed would be affected by temperature. 

So if wind speed is not impacted by ðŸ”¥  then what?

We think the wind speed might be impacted by the location of ðŸŒ²  and buildings around Melbourne. 

To investigate our hypothesis we used data from [City of Melbourne Open Data-Urban Forest](https://data.melbourne.vic.gov.au/Environment/Trees-with-species-and-dimensions-Urban-Forest-/fp38-wiyy)

.footer[`r icon::fa('book')` ETC5523:Communicating with Data]

---

## .white[Why is the wind speed different?]

```{r xaringan-panelset, echo=FALSE}
xaringanExtra::use_panelset()
```

.panelset[
.panel[.panel-name[Summary]

As previously shown:

> 87-89 Grattan St and the Cnr of Pelham and Leiscester St are windier than the other spots

Notice from the map:

> The other spots are clustered together and sit in between two parks with lots of trees which could explain the lower wind speed.

> 87-89 Grattan St and the Cnr of Pelham and Leiscester St have higher wind speeds and are relatively unprotected.  

]

.panel[.panel-name[Plot]

```{r, echo=FALSE, fig.width=14, fig.height=6}
tree_data0 <- read_csv("trees_raw.csv")

tree_data <- tree_data0 %>% 
  rename(Dateplanted = `Date Planted`,
         Yearplanted = `Year Planted`) %>%  
  mutate(Dateplanted = dmy(Dateplanted), # also make_date() produces the same result
         Year = year(Dateplanted))           # extract the year from a date object

tree_data_clean0 <- tree_data %>%
  filter(!is.na(Dateplanted))

tree_data_clean <- tree_data_clean0 %>% 
  mutate(Year = case_when(
    Yearplanted != year(Dateplanted) ~  Yearplanted,
    TRUE ~ Year
  ))

tree_sub <- tree_data_clean %>% 
  filter(Longitude > 144.96 & Longitude < 144.967,
         Latitude > -37.804  & Latitude < -37.799)

 greenLeafIcon <- makeIcon(
  iconUrl = "http://leafletjs.com/examples/custom-icons/leaf-green.png",
  iconWidth = 20, iconHeight = 30,
  iconAnchorX = 22, iconAnchorY = 94,
  shadowUrl = "http://leafletjs.com/examples/custom-icons/leaf-shadow.png",
  shadowWidth = 12, shadowHeight = 25,
  shadowAnchorX = 4, shadowAnchorY = 62
)


leaflet() %>% 
  addProviderTiles("Esri") %>% 
  addMarkers(lng = loc$longitude,
             lat = loc$latitude,
             popup = loc$description,
  ) %>% 
  addMarkers(lng = tree_sub$Longitude,
             lat = tree_sub$Latitude,
             icon = greenLeafIcon,
             )
```

]
]

---
class: center inverse
### .black[Can we trust the data]â“
--

Let's review the quality of the dataset.

--

`r anicon::faa("exclamation-triangle", animate="vertical", size = 2)`

```{r fig.height=6, fig.width = 14, fig.retina=3}
sensors %>% 
  filter(units == "km/h") %>% 
  ggplot(aes(value, group = site_id, fill = description )) +
  geom_histogram(alpha = 0.4)  + 
  ggthemes::theme_solarized() +
  theme(legend.position = "bottom",
        legend.title =  element_blank(),
        legend.box.background = element_blank(),
        strip.text.x = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.subtitle = ggtext::element_markdown(),
        axis.title.y = ggtext::element_textbox_simple(
          size = 13,
          width = NULL,
          orientation = "left-rotated",
          padding = margin(4, 4, 4, 4),
          margin = margin(4, 0, 0, 0),
          linetype = 1,
          r = grid::unit(8, "pt"),
          fill = "azure1",
        ),
        axis.title.x = ggtext::element_textbox_simple(
          size = 13,
          width = NULL,
          padding = margin(4, 4, 4, 4),
          margin = margin(4, 0, 0, 0),
          linetype = 1,
          r = grid::unit(8, "pt"),
          fill = "azure1",
        ),
        plot.title  = ggtext::element_textbox_simple(
          size = 13,
          width = NULL,
          padding = margin(4, 4, 4, 4),
          margin = margin(4, 0, 10, 0),
          linetype = 1,
          r = grid::unit(8, "pt"),
          fill = "azure1",
        ),
        legend.key = element_rect(fill = "transparent", colour = "transparent")) +
  ggthemes::scale_fill_colorblind() +
  guides(fill=guide_legend(nrow=2, byrow=TRUE)) +
  labs(
    x = "Wind Speed",
    y = "Count",
    title = "Distribution of Wind Speed Measurements",
    subtitle = 
      "Notice that there are <span style='color:red'>no observations</span> between 0.1 and 4. <br><br>
    Also, notice the large count of measurements for a wind speed of __zero__,
    which might be an indicator of the sensors being unable to detect soft winds"
  ) 


```


`r anicon::nia("No values between 0.01 and 4", animate = "tada")`
---

class: split-two white center

.row.bg-main1[.content.vmiddle[
# Conclusion
]]
.row.bg-main2[
.split-two[
.column.middle[

#### The city is the windiest in the summer months. 

#### Wind speed typically reaches its highest point between 1-2pm.

#### The wind speed is above average for all locations in December.

#### 87-89 Grattan St and the Cnr of Leicester and Pelham St have an above average wind speed, comparative to other locations.

#### 87-89 Grattan St and the Cnr of Leicester and Pelham St have less trees than the three sensors clustered together.

]
]
]
---
class: inverse, question, middle

# Questions 

```{r, echo=FALSE}
xaringanExtra::use_editable()
```

<span style="color:blue";>.can-edit[--]</span>

.right[
```{r, warning=FALSE, message=FALSE, error=FALSE, echo=FALSE, fig.height=2, fig.width=2, fig.retina=3}
library(RBitmoji)
set.seed(10)
plot_comic("b0f43c83-b6a4-4e2f-90b4-b100a31cd696-v1", tag = "question", 
           transparent = TRUE)
```
]
<br>

`r countdown::countdown(2, class="clock", right = "30px", 
play_sound = TRUE,
color_border              = "blue",
  color_text                = "blue",
  color_running_background  = "cyan",
  color_finished_background = "red")`

---



# Thank you!

## .white[Find us:]

```{r, fig.cap="Pete's Website", echo=FALSE}
knitr::include_graphics("images/qr_pete.png") #<<
```


